aspgn
tspgn3<-system.time(aspgn3 <- spg(par=(1:n)/n^2, fn=nllrv, gr=NULL, project=proj3))[[3]]
aspgn3
spar <- aspgn3$par/sum(aspgn3$par^2)
spar
sum(spar^2)
proj3 <- function(x) {x/sqrt(sum(x^2)}
proj3 <- function(x) {x/sqrt(sum(x^2))}
tspgn3<-system.time(aspgn3 <- spg(par=(1:n)/n^2, fn=nllrv, gr=NULL, project=proj3))[[3]]
aspgn3
upar <- aspgn3$par
upar
spar <- upar/sqrt(sum(upar^2))
spar
sum(spar^2)
cumprod(spar)
prod(spar)
savehistory("161214sumsqscale.txt")
nllrv <- function(x) {- sum(log(x))}
nllrv.g <- function(x) {- 1/x }
proj <- function(x) {x/sum(x)}
nllrv <- function(x) {- sum(log(x))}
nllrv.g <- function(x) {- 1/x }
proj <- function(x) {x/sum(x)}
n <- 5
tspg<-system.time(aspg <- spg(par=(1:n)/n^2, fn=nllrv, gr=nllrv.g, project=proj))[[3]]
tspgn<-system.time(aspgn <- spg(par=(1:n)/n^2, fn=nllrv, gr=NULL, project=proj))[[3]]
cat("Times: with gradient =",tspg,"   using numerical approx.=", tspgn,"\n")
cat("F_optimal: with gradient=",aspg$value,"  num. approx.=",aspgn$value,"\n")
pbest<-rep(1/n, n)
cat("fbest = ",nllrv(pbest),"  when all parameters = ", pbest[1],"\n")
cat("deviations:  with gradient=",max(abs(aspg$par-pbest)),"   num. approx.=",max(abs(aspg$par-pbest)),"\n")
cat("deviations:  with gradient=",max(abs(aspg$par-pbest)),"   num. approx.=",max(abs(aspgn$par-pbest)),"\n")
n<-100
tspgh<-system.time(aspgh <- spg(par=(1:n)/n^2, fn=nllrv, gr=nllrv.g, project=proj))[[3]]
tspgnh<-system.time(aspgnh <- spg(par=(1:n)/n^2, fn=nllrv, gr=NULL, project=proj))[[3]]
cat("Times: with gradient =",tspgh,"   using numerical approx.=", tspgnh,"\n")
cat("F_optimal: with gradient=",aspgh$value,"  num. approx.=",aspgnh$value,"\n")
pbest<-rep(1/n, n)
cat("fbest = ",nllrv(pbest),"  when all parameters = ", pbest[1],"\n")
cat("deviations:  with gradient=",max(abs(aspgh$par-pbest)),"   num. approx.=",max(abs(aspgn$par-pbest)),"\n")
cat("deviations:  with gradient=",max(abs(aspgh$par-pbest)),"   num. approx.=",max(abs(aspgnh$par-pbest)),"\n")
n <- 5
tspg<-system.time(aspg <- spg(par=(1:n)/n^2, fn=nllrv, gr=nllrv.g, project=proj))[[3]]
tspgn<-system.time(aspgn <- spg(par=(1:n)/n^2, fn=nllrv, gr=NULL, project=proj))[[3]]
cat("Times: with gradient =",tspg,"   using numerical approx.=", tspgn,"\n")
cat("F_optimal: with gradient=",aspg$value,"  num. approx.=",aspgn$value,"\n")
pbest<-rep(1/n, n)
cat("fbest = ",nllrv(pbest),"  when all parameters = ", pbest[1],"\n")
cat("deviations:  with gradient=",max(abs(aspg$par-pbest)),"   num. approx.=",max(abs(aspgn$par-pbest)),"\n")
n<-100
tspgh<-system.time(aspgh <- spg(par=(1:n)/n^2, fn=nllrv, gr=nllrv.g, project=proj))[[3]]
tspgnh<-system.time(aspgnh <- spg(par=(1:n)/n^2, fn=nllrv, gr=NULL, project=proj))[[3]]
cat("Times: with gradient =",tspgh,"   using numerical approx.=", tspgnh,"\n")
cat("F_optimal: with gradient=",aspgh$value,"  num. approx.=",aspgnh$value,"\n")
pbesth<-rep(1/n, n)
cat("fbest = ",nllrv(pbesth),"  when all parameters = ", pbesth[1],"\n")
cat("deviations:  with gradient=",max(abs(aspgh$par-pbesth)),"   num. approx.=",max(abs(aspgnh$par-pbesth)),"\n")
n<-1000
tspgt<-system.time(aspgt <- spg(par=(1:n)/n^2, fn=nllrv, gr=nllrv.g, project=proj))[[3]]
tspgnt<-system.time(aspgnt <- spg(par=(1:n)/n^2, fn=nllrv, gr=NULL, project=proj))[[3]]
cat("Times: with gradient =",tspgt,"   using numerical approx.=", tspgnt,"\n")
cat("F_optimal: with gradient=",aspgt$value,"  num. approx.=",aspgnt$value,"\n")
pbestt<-rep(1/n, n)
cat("fbest = ",nllrv(pbestt),"  when all parameters = ", pbestt[1],"\n")
ls()
n
stt <- (1:n)/n^2
stt
ls()
nllrv(stt)
nllrv.g(stt)
tspgt<-system.time(aspgt <- spg(par=(1:n)/n^2, fn=nllrv, gr=nllrv.g, project=proj))[[3]]
warning()
warnings()
tspgt<-system.time(aspgt <- spg(par=(1:n)/n^2, fn=nllrv, gr=nllrv.g, project=proj))[[3]]
warnings()
n <- 5
s5 <- (1:5)/25
all5 <- opm(s5, nllrv, gr="grfwd", method="ALL")
all5
all5 <- opm(s5, nllrv, gr="grfwd", method="ALL")
all5 <- opm(s5, nllrv, gr="grfwd", method="ALL", control=list(trace=1))
mlist
mlist<-c("nlm", "Rvmmin". "Rcgmin", "nmkb")
mlist<- c("nlm", "Rvmmin". "Rcgmin", "nmkb")
mlist<- c("nlm", "Rvmmin", "Rcgmin", "nmkb")
all5 <- opm(s5, nllrv, gr="grfwd", method=mlist, control=list(trace=1))
all5
summary(all5, order=value)
snllrv <- function(x) {- sum(log(x/sum(x)))}
all5 <- opm(s5, snllrv, gr="grfwd", method=mlist, control=list(trace=1))
all5
all5 <- opm(s5, snllrv, gr="grnd", method=mlist, control=list(trace=1))
all5
all5 <- opm(s5, snllrv, method=mlist, control=list(trace=1))
all5
all5 <- opm(s5, snllrv, gr="grcentral", method="ALL", control=list(trace=1))
all5
n<-100
s100 <- (1:100)/1e4
allh <- opm(s100, snllrv, gr="grcentral", method="ALL", control=list(trace=1))
summary(allh, order=value)
summary(allh, order=value, par.select=1:3)
ls()
stt
cgt <- optimr(stt, snllrv, gr="grnd", method="Rcgmin")
cgt <- optimr(stt, snllrv, gr="grcentral", method="Rcgmin")
summary(cgt)
cgt
cgt <- optimr(stt, snllrv, gr="grback", method="Rcgmin")
warnings()
summary(allh, order=value)
summary(allh, order=value, par.select=1:3)
spgh<-optimr(sth, snllrv, method="spg")
ls()
st
stm
stt
sth <- (1:100)/1e4
spgh<-optimr(sth, snllrv, method="spg")
spgh
snllrv(sth)
savehistory("161214snllrv.txt")
require(optimrx, quietly=TRUE) # just to be sure
st<-1:5/10 # 5 parameters, crude scaling to start
a5x<-opm(st, enll, enll.g, method="ALL", control=list(trace=0))
a5xbyvalue<-summary(a5x, order=value, par.select=1:2)
st<-1:5/10 # 5 parameters, crude scaling to start
a5x<-opm(st, enll, enll.g, method="ALL", control=list(trace=0))
a5x<-opm(st, enll, enll.g, method="ALL", control=list(trace=0))
enll <- function(lx) {
x<-exp(lx)
fval<-  - sum( log( x/sum(x) ) )
}
enll.g <- function(lx){
x<-exp(lx)
g<-length(x)/sum(x) - 1/x
gval<-g*exp(lx)
}
st<-1:5/10 # 5 parameters, crude scaling to start
a5x<-opm(st, enll, enll.g, method="ALL", control=list(trace=0))
a5xbyvalue<-summary(a5x, order=value, par.select=1:2)
xnor<-a5xbyvalue[1, 1:5] # get the 5 parameters of "best" solution
print(a5xbyvalue)
ftest <- sum(crossprod(x-(1:n)))
ftest <- function(x) {sum(crossprod(x-(1:n)))}
test <- ucminf(1:10, ftest)
require(ucminf)
test <- ucminf(1:10, ftest)
rm(list=ls())
sq<-function(x){
nn<-length(x)
yy<-1:nn
f<-sum((yy-x)^2)
cat("Fv=",f," at ")
print(x)
f
}
sq.g <- function(x){
nn<-length(x)
yy<-1:nn
gg<- 2*(x - yy)
}
require(Rvmmin)
require(numDeriv)
x<-rep(pi,3)
fv0<-sq(x)
ga<-sq.g(x)
print(ga)
gn<-grad(sq,x)
print(gn)
cat("Show trajectory differences BFGS and Rvmmin\n")
opt1<-optim(x, sq, sq.g, control=list(trace=4), method="BFGS")
opt1r<-Rvmmin(x, sq, sq.g, control=list(trace=1))
require("minqa")
cat("Show minqa results\n")
strt<-rep(pi,5)
print(sq(strt))
abob<-bobyqa(strt, sq, lower=rep(-10,5), upper=rep(10,5), control=list(iprint=3))
print(abob)
print(str(abob))
require(ucminf)
au <- ucminf(strt, sq, sq.g, control=list(trace=1))
remove.packages("ucminf")
install.packages("ucminf")
install.packages("ucminf")
source('/media/john/J6R/mainset/jn/R-optimtest/testfnsR/simple/sq.R')
require(ucminf)
au <- ucminf(strt, sq, sq.g, control=list(trace=1))
require(optimrx, quietly=TRUE) # just to be sure
st<-1:5/10 # 5 parameters, crude scaling to start
a5x<-opm(st, enll, enll.g, method="ALL", control=list(trace=0))
a5xbyvalue<-summary(a5x, order=value, par.select=1:2)
print(a5xbyvalue)
xnor<-a5xbyvalue[1, 1:5] # get the 5 parameters of "best" solution
xnor<-xnor/sum(xnor)
cat("normalized parameters:")
print(xnor)
enll <- function(lx) {
x<-exp(lx)
fval<-  - sum( log( x/sum(x) ) )
}
enll.g <- function(lx){
x<-exp(lx)
g<-length(x)/sum(x) - 1/x
gval<-g*exp(lx)
}
require(optimrx, quietly=TRUE) # just to be sure
st<-1:5/10 # 5 parameters, crude scaling to start
a5x<-opm(st, enll, enll.g, method="ALL", control=list(trace=0))
a5xbyvalue<-summary(a5x, order=value, par.select=1:2)
print(a5xbyvalue)
xnor<-a5xbyvalue[1, 1:5] # get the 5 parameters of "best" solution
xnor<-xnor/sum(xnor)
cat("normalized parameters:")
print(xnor)
ls()
a5x
str(a5x)
a4x$par
a5x$par
a5x[,1:5]
dim(a5x)
for (ir in 1:18){}
for (ir in 1:18){
vec <- a5x[ir, 1:5]
vec <- vec/sum(vec)
a5x[ir,1:5] <- vec
}
a5x
savehistory(161214rescale.txt)
savehistory(161214rescale.txt"")
savehistory("161214rescale.txt"")
)
savehistory("161214rescale.txt")
nll <- function(y) { # large result if near zero arguments to log()
if ((any(y <= 10*.Machine$double.xmin)) || (sum(y)>1-.Machine$double.eps))
.Machine$double.xmax
else   - sum(log(y)) - log(1-sum(y))
}
nll.g <- function(y) { - 1/y + 1/(1-sum(y))} # so far not safeguarded
require(optimrx, quietly=TRUE)
n<-5
lo <- c(rep(-100, (n-1)),1))
lo <- c(rep(-100, (n-1)),1)
up <- c(rep(100, (n-1)),1)
mmth <- c("Rvmmin", "Rcgmin")
strt <- (1:n)/n^2
amsk1 <- opm(strt, enll, enll.g, lower=lo, upper=up, method=mmth)
print(amsk1)
mmth <- c("Rvmmin", "Rcgmin")
strt <- (1:n)/n^2
lo <- c(rep(-100, (n-1)),strt[n])
up <- c(rep(100, (n-1)),strt[n])
lo
up
amsk1 <- opm(strt, enll, enll.g, lower=lo, upper=up, method=mmth)
print(amsk1)
amsk1 <- summary(amsk1, order=value)
parmsk <- amsk1[1, 1:n]
parmsk <- parmsk/sum(parmsk)
print(parmsk)
n<-100
lo <- c(rep(-100, (n-1)),strt[n])
up
strt <- (1:n)/n^2
lo <- c(rep(-100, (n-1)),strt[n])
up <- c(rep(100, (n-1)),strt[n])
lo
up
amsk1 <- opm(strt, enll, enll.g, lower=lo, upper=up, method=mmth)
print(parmsk)
print(amsk1)
amsk1 <- summary(amsk1, order=value)
amsk1
strt
strt <- (1:n)/n
strt
lo <- c(rep(-100, (n-1)),strt[n])
up <- c(rep(100, (n-1)),strt[n])
amsk1 <- opm(strt, enll, enll.g, lower=lo, upper=up, method=mmth)
amsk1
cat("try loading optimrx\n")
require(optimrx, quietly=TRUE)
pr <- function(y) {
- prod(y)*(1-sum(y))
}
cat("test the simple product for n=5\n")
meth <- c("Nelder-Mead", "BFGS")
n<-5
m<-n-1
st<-1:m/(m*m)
ans<-opm(st, pr, gr="grcentral", control=list(trace=0))
ao<-summary(ans,order=value)
print(ao)
par <- ao[1,1:m]
par <- c(par, 1-sum(par))
par <- par/sum(par)
par
par <- ao[1,1:m]
par
str(par)
par <- as.vector(ao[1,1:m])
par
str(par)
par <- as.double(ao[1,1:m])
par
par <- as.double(ao[1,1:m])
par <- c(par, 1-sum(par))
par <- par/sum(par)
cat("Best parameters:")
print(par)
stm <- st*((-1)^(1:4))
print(stm)
ansm<-opm(stm, pr, gr="grcentral", control=list(trace=0))
aom <- summary(ansm, order=value)
print(aom)
nll <- function(y) { # large result if near zero arguments to log()
if ((any(y <= 10*.Machine$double.xmin)) || (sum(y)>1-.Machine$double.eps))
.Machine$double.xmax
else   - sum(log(y)) - log(1-sum(y))
}
nll.g <- function(y) { - 1/y + 1/(1-sum(y))} # so far not safeguarded
mset<-c("L-BFGS-B", "spg", "nlm", "nlminb", "Rvmmin", "Rcgmin")
a5<-opm(2:n/n^2, nll, gr="grfwd", method=mset, control=list(dowarn=FALSE))
a5g<-opm(2:n/n^2, nll, nll.g, method=mset, control=list(dowarn=FALSE))
a5gb<-opm(2:n/n^2, nll, nll.g, lower=0, upper=1, method=mset, control=list(dowarn=FALSE))
summary(a5,order=value)
summary(a5g,order=value)
summary(a5gb,order=value)
require(BB, quietly=TRUE)
nllrv <- function(x) {- sum(log(x))}
nllrv.g <- function(x) {- 1/x }
proj <- function(x) {x/sum(x)}
n <- 5
tspg<-system.time(aspg <- spg(par=(2:n)/n^2, fn=nllrv, gr=nllrv.g, project=proj))[[3]]
tspgn<-system.time(aspgn <- spg(par=(2:n)/n^2, fn=nllrv, gr=NULL, project=proj))[[3]]
cat("Times: with gradient =",tspg,"   using numerical approx.=", tspgn,"\n")
cat("F_optimal: with gradient=",aspg$value,"  num. approx.=",aspgn$value,"\n")
pbest<-rep(1/n, n)
cat("fbest = ",nllrv(pbest[2:n]),"  when all parameters = ", pbest[1],"\n")
cat("deviations:  with gradient=",max(abs(aspg$par-pbest)),"   num. approx.=",max(abs(aspgn$par-pbest)),"\n")
pbest<-rep(1/n, n-1)
cat("fbest = ",nllrv(pbest),"  when all parameters = ", pbest[1],"\n")
pbest
pbest<-rep(1/n, n)
cat("fbest = ",nllrv(pbest[2:n]),"  when all parameters = ", pbest[1],"\n")
aspg
aspg$par
tspg<-system.time(aspg <- spg(par=(1:n)/n^2, fn=nllrv, gr=nllrv.g, project=proj))[[3]]
tspgn<-system.time(aspgn <- spg(par=(1:n)/n^2, fn=nllrv, gr=NULL, project=proj))[[3]]
cat("Times: with gradient =",tspg,"   using numerical approx.=", tspgn,"\n")
cat("F_optimal: with gradient=",aspg$value,"  num. approx.=",aspgn$value,"\n")
pbest<-rep(1/n, n)
cat("fbest = ",nllrv(pbest[2:n]),"  when all parameters = ", pbest[1],"\n")
cat("deviations:  with gradient=",max(abs(aspg$par-pbest)),"   num. approx.=",max(abs(aspgn$par-pbest)),"\n")
aspg$par
cat("fbest = ",nllrv(pbest),"  when all parameters = ", pbest[1],"\n")
n<-100
tspgh<-system.time(aspgh <- spg(par=(1:n)/n^2, fn=nllrv, gr=nllrv.g, project=proj))[[3]]
tspgnh<-system.time(aspgnh <- spg(par=(1:n)/n^2, fn=nllrv, gr=NULL, project=proj))[[3]]
cat("Times: with gradient =",tspgh,"   using numerical approx.=", tspgnh,"\n")
cat("F_optimal: with gradient=",aspgh$value,"  num. approx.=",aspgnh$value,"\n")
pbesth<-rep(1/n, n)
cat("fbest = ",nllrv(pbesth),"  when all parameters = ", pbesth[1],"\n")
cat("deviations:  with gradient=",max(abs(aspgh$par-pbesth)),"   num. approx.=",max(abs(aspgnh$par-pbesth)),"\n")
enll <- function(lx) {
x<-exp(lx)
fval<-  - sum( log( x/sum(x) ) )
}
enll.g <- function(lx){
x<-exp(lx)
g<-length(x)/sum(x) - 1/x
gval<-g*exp(lx)
}
require(optimrx, quietly=TRUE) # just to be sure
st<-1:5/10 # 5 parameters, crude scaling to start
st<-log(st)
n <- 5
mset<-c("L-BFGS-B", "spg", "nlm", "nlminb", "Rvmmin", "Rcgmin")
a5x<-opm(st, enll, enll.g, method=mset, control=list(trace=0))
a5xbyvalue<-summary(a5x, order=value)
print(a5xbyvalue)[(n+1):(n+7)]
xnor<-exp(a5xbyvalue[1, 1:5]) # get the 5 parameters of "best" solution, exponentiate
xnor<-xnor/sum(xnor)
cat("best normalized parameters:")
print(xnor)
require(Rcgmin, quietly=TRUE)
st<-1:100/1e3 # large
stenll<-enll(st)
cat("Initial function value =",stenll,"\n")
tym<-system.time(acgbig<-Rcgmin(st, enll, enll.g, control=list(trace=0, tol=1e-32)))[[3]]
cat("Time = ",tym,"  fval=",acgbig$value,"\n")
st<-1:100/1e3 # large
stenll<-enll(st)
tym<-system.time(acgbig<-optimr(st, enll, enll.g, method="Rcgmin" control=list(trace=0, tol=1e-32)))[[3]]
tym<-system.time(acgbig<-optimr(st, enll, enll.g, method="Rcgmin", control=list(trace=0, tol=1e-32)))[[3]]
cat("Time = ",tym,"  fval=",acgbig$value,"\n")
xnor<-acgbig$par
xnor<-exp(xnor)/sum(exp(xnor)) # back transform
cat("Average parameter is ", mean(xnor)," with max deviation", max(abs(xnor-mean(xnor))),"\n")
proj2 <- function(theta) {
theta2 <- theta^2
s2 <- theta2 / (1 + theta2)
cumprod(c(1, s2)) * c(1-s2, 1)
}
obj <- function(theta) - sum(log(proj2(theta)))
n <- 5
ans <- spg(seq(n-1), obj)
proj2(ans$par)
seq(n-1)
seq(n)
proj2(1)
proj2(1:4)
sum(proj2(1:4))
?cumprod
xx <- 1:4
cumprod(xx)
cumprod(xx*(25-xx))
25-xx
sxx<-sin(xx)^2
sxx
cxx<-cos(xx)^2
sxx+cxx
proj <- function(theta) {
s2 <- sin(theta)^2
cumprod(c(1, s2)) * c(1-s2, 1)
}
proj(xx)
sum(proj(xx))
proj2
proj(xx)
proj2(xx)
sum(proj2(xx))
sum(proj(xx))
cumsum(proj(xx))
cumsum(proj2(xx))
xx<-1:2
s2<-sin(xx)^2
s2
c1<-c(1,s2)
c1
c2<-c(1-s2, 1)
c2
cc <- c1*c2
cc
ccc<-cumprod(cc)
ccc
sum(ccc)
rm(ccc)
rm(cc)
c1
c2
cc1<-cumprod(c1)
cc1
c2
ccc<-cc1*c2
sum(ccc)
proj
xx<-2
s2<-sin(xx)^2
c1<-c(1,s2)
c1
s2
cc1<-cumprod(c1)
cc1
c2<-c(1-s2,1)
c2
proj
n<-5
mmth <- c("Rvmmin", "Rcgmin")
strt <- (1:n)/n
lo <- c(rep(-100, (n-1)),strt[n])
up <- c(rep(100, (n-1)),strt[n])
amsk1 <- opm(strt, enll, enll.g, lower=lo, upper=up, method=mmth)
print(amsk1)
amsk1 <- summary(amsk1, order=value)
parmsk <- amsk1[1, 1:n]
parmsk <- parmsk/sum(parmsk)
print(parmsk)
n<-100
mmth <- c("Rvmmin", "Rcgmin")
strt <- (1:n)/n
lo <- c(rep(-100, (n-1)),strt[n])
up <- c(rep(100, (n-1)),strt[n])
amsk1 <- opm(strt, enll, enll.g, lower=lo, upper=up, method=mmth)
print(amsk1)
amsk1 <- summary(amsk1, order=value)
parmsk <- amsk1[1, 1:n]
parmsk <- parmsk/sum(parmsk)
print(parmsk)
library(nleqslv)
install.packages("nleqslv")
library(nleqslv)
?nleqslv
x<-1:5
ls()
tn <- nleqslv(x, nll.g)
tn
ls
ls()
tn$x
parn <- tn$x/sum(tn$x)
parn
te <- nleqslv(x, enll.g)
te
te$x
xh<-1:100
teh <- nleqslv(xh, enll.g)
teh
teh$x
