<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="John C. Nash" />

<meta name="date" content="2015-01-15" />

<title>nls14 Background, Examples and Discussion</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">nls14 Background, Examples and Discussion</h1>
<h4 class="author"><em>John C. Nash</em></h4>
<h4 class="date"><em>2015-01-15</em></h4>
</div>


<p>This vignette is to explain <strong>nls14</strong>, an R package to try to bring the <strong>R</strong> function nls() up to date and to add capabilities for the extension of the symbolic and automatic derivative tools in <strong>R</strong></p>
<p>A particular goal in <strong>nls14</strong> is to attempt, wherever possible, to use analytic or automatic derivatives. The function nls() uses a rather weak forward derivative approximation. A second objective is to use a Marquardt stabilization of the Gauss-Newton equations to avoid the commonly encountered “singular gradient” failure of nls(). This refers to the loss of rank of the Jacobian at the parameters for evaluation. The particular stabilization also incorporates a very simple trick to avoid very small diagonal elements of the Jacobian inner product, though in the present implementations, this is accomplished indirectly. See the section below <strong>Implementation of method</strong></p>
<p>A large part of the work of this package was carried out by Duncan Murdoch. Without his input, much of the capability of the package would not exist.</p>
<p>The package and this vignette are a work in progress, and assistance and examples are welcome.</p>
<div id="summary-of-capabilities" class="section level2">
<h2>Summary of capabilities</h2>
<div id="coef.nls14" class="section level4">
<h4>coef.nls14</h4>
<p>extracts and displays the coefficients for a model estimated by nlxb() or nlfb() in the nls14 structured object.</p>
</div>
<div id="deriv" class="section level4">
<h4>Deriv</h4>
</div>
<div id="fnderiv" class="section level4">
<h4>fnDeriv</h4>
</div>
<div id="newderiv" class="section level4">
<h4>newDeriv</h4>
<p>Functions <strong>Deriv</strong> and <strong>fnDeriv</strong> are designed as replacements for the stats package functions <strong>D</strong> and <strong>deriv</strong> respectively, though the argument lists do not match exactly.</p>
</div>
<div id="findsubexprs" class="section level4">
<h4>findSubexprs</h4>
<p>This function finds common subexpressions in an expression vector so that duplicate computation can be avoided.</p>
</div>
<div id="model2rjfun" class="section level4">
<h4>model2rjfun</h4>
</div>
<div id="model2ssgrfun" class="section level4">
<h4>model2ssgrfun</h4>
</div>
<div id="modelexpr" class="section level4">
<h4>modelexpr</h4>
<p>These functions create functions to evaluate residuals or sums of squares at particular parameter locations.</p>
</div>
<div id="model2rjfunx" class="section level4">
<h4>model2rjfunx</h4>
</div>
<div id="model2ssgrfunx" class="section level4">
<h4>model2ssgrfunx</h4>
<p>These functions create functions to evaluate residuals or sums of squares at particular parameter locations. The attempt is to have dot-args available. This is experimental.</p>
</div>
<div id="modeldoc" class="section level4">
<h4>modeldoc</h4>
</div>
<div id="print.modeldoc" class="section level4">
<h4>print.modeldoc</h4>
<p>Output a description of the model and the data that was used at the time of its creation to the console and optionally to a file. The purpose of this function is to provide a record of the details underlying the function</p>
</div>
<div id="nlfb" class="section level4">
<h4>nlfb</h4>
<p>Given a nonlinear model expressed as an expression of the form lhs ~ formula_for_rhs and a start vector where parameters used in the model formula are named, attempts to find the minimum of the residual sum of squares using the Nash variant (Nash, 1979) of the Marquardt algorithm, where the linear sub-problem is solved by a qr method.</p>
</div>
<div id="nls14fb" class="section level4">
<h4>nls14fb</h4>
<p>Given a nonlinear model expressed as an expression of the form lhs ~ formula_for_rhs and a start vector where parameters used in the model formula are named, attempts to find the minimum of the residual sum of squares using the Nash variant (Nash, 1979) of the Marquardt algorithm, where the linear sub-problem is solved by a qr method.</p>
</div>
<div id="nls14xb" class="section level4">
<h4>nls14xb</h4>
<p>Given a nonlinear model expressed as an expression of the form lhs ~ formula_for_rhs and a start vector where parameters used in the model formula are named, attempts to find the minimum of the residual sum of squares using the Nash variant (Nash, 1979) of the Marquardt algorithm, where the linear sub-problem is solved by a qr method.</p>
</div>
<div id="print.nls14" class="section level4">
<h4>print.nls14</h4>
<p>Print summary output (but involving some serious computations!) of an object of class nls14 from  or  from package .</p>
</div>
<div id="resgr" class="section level4">
<h4>resgr</h4>
<p>For a nonlinear model originally expressed as an expression of the form lhs ~ formula_for_rhs assume we have a resfn and jacfn that compute the residuals and the Jacobian at a set of parameters. This routine computes the gradient, that is, t(Jacobian) . residuals.</p>
</div>
<div id="resss" class="section level4">
<h4>resss</h4>
<p>For a nonlinear model originally expressed as an expression of the form lhs ~ formula_for_rhs assume we have a resfn and jacfn that compute the residuals and the Jacobian at a set of parameters. This routine computes the gradient, that is, t(Jacobian) %*% residuals.</p>
</div>
<div id="newsimplification" class="section level4">
<h4>newSimplification</h4>
</div>
<div id="simplify" class="section level4">
<h4>Simplify</h4>
</div>
<div id="syssimplifications" class="section level4">
<h4>sysSimplifications</h4>
</div>
<div id="isfalse" class="section level4">
<h4>isFALSE</h4>
</div>
<div id="iszero" class="section level4">
<h4>isZERO</h4>
</div>
<div id="isone" class="section level4">
<h4>isONE</h4>
</div>
<div id="isminusone" class="section level4">
<h4>isMINUSONE</h4>
<p>Functions to simplify expressions.  simplifies expressions according to rules specified by .</p>
</div>
<div id="summary.nls14" class="section level4">
<h4>summary.nls14</h4>
<p>Provide a summary output (but involving some serious computations!) of an object of class nls14 from nls14xb or nls14fb from package nls14.</p>
</div>
<div id="wrap14nls" class="section level4">
<h4>wrap14nls</h4>
<p>Given a nonlinear model expressed as an expression of the form</p>
<pre><code>lhs ~ formula_for_rhs</code></pre>
<p>and a start vector where parameters used in the model formula are named, attempts to find the minimum of the residual sum of squares using the Nash variant (Nash, 1979) of the Marquardt algorithm, where the linear sub-problem is solved by a qr method.</p>
</div>
</div>
<div id="implementation-of-method" class="section level2">
<h2>Implementation of method</h2>
<p>Nonlinear least squares methods are mostly founded on some or other variant of the Gauss-Newton algorithm. The function we wish to minimize is the sum of squares of the (nonlinear) residuals r(x) where there are m observations (elements of r) and n parameters x. Hence the function is</p>
<p>f(x) = sum(r(k)^2)</p>
<p>Newton’s method starts with an original set of parameters x[0]. At a given iteraion, which could be the first, we want to solve</p>
<p>x[k+1] = x[k] - H^(-1) g</p>
<p>where H is the Hessian and g is the gradient at x[k]. We can rewrite this as a solution, at each iteration, of H delta = -g with x[k+1] = x[k] + delta</p>
<p>For the particular sum of squares, the gradient is</p>
<pre><code>     g(x) = 2 * r(k)</code></pre>
<p>and</p>
<pre><code>     H(x) = 2 ( J' J  +  sum(r * Z))</code></pre>
<p>where J is the Jacobian (first derivatives of r w.r.t. x) and Z is the tensor of second derivatives of r w.r.t. x). Note that J’ is the transpose of J.</p>
<p>The primary simplification of the Gauss-Newton method is to assume that the second term above is negligible. As there is a common factor of 2 on each side of the Newton iteration after the simplification of the Hessian, the Gauss-Newton iteration equation is</p>
<pre><code>       J' J  delta = - J' r
       </code></pre>
<p>This iteration frequently fails. The approximation of the Hessian by the Jacobian inner-product is one reason, but there is also the possibility that the sum of squares function is not “quadratic” enough that the unit step reduces it. Hartley introduced a line search along delta, while Marquardt suggested replacing J’ J with (J’ J + lambda * D) where D is a diagonal matrix intended to partially approximate the omitted portion of the Hessian.</p>
<p>Marquardt suggested D = I (a unit matrix) or D = (diagonal part of J’ J). The former approach, when lambda is large enough that the iteration is essentially</p>
<pre><code>  delta = - g / lambda
  </code></pre>
<p>we get a version of the steepest descents algorithm. Using the diagonal of J’ J, we have a scaled version of this (see <a href="http://en.wikipedia.org/wiki/Levenberg%E2%80%93Marquardt_algorithm">http://en.wikipedia.org/wiki/Levenberg%E2%80%93Marquardt_algorithm</a>)</p>
<p>Nash (1977) ??ref?? found that on low precision machines, it was common for diagonal elements of J’ J to underflow. A very small modification to solve</p>
<pre><code>(J' J + lambda * (D + phi * I)) * delta = - g</code></pre>
<p>where phi is a small number (phi = 1 seems to work quite well) ?? check??.</p>
<p>In Nash (1979), the iteration equation was solved as stated. However, this involves forming the sum of squares and cross products of J, a process that loses some numerical precision. A better way to solve the linear equations is to apply the QR decomposition to the matrix J itself. However, we still need to incorporate the lambda * I or lambda * D adjustments. This is done by adding rows to J that are the square roots of the “pieces”. We add 1 row for each diagonal element of I and each diagonal element of D.</p>
<p>In each iteration, we reduce the lambda parameter before solution. If the resulting sum of squares is not reduced, lambda is increased, otherwise we move to the next iteration.</p>
</div>
<div id="providing-extra-data-to-expressions" class="section level2">
<h2>Providing extra data to expressions</h2>
<p>Almost all statistical functions have exogenous data that is needed to compute residuals or likelihoods and is not dependent on the model parameters. (This section starts from Notes140806.)</p>
<p>model2rjfun does NOT have … args.</p>
<p>Should it have? i.e., a problem where we are fitting a set of time series, 1 for each plant/animal, with some sort of start parameter for each that is NOT estimated (e.g., pH of soil, some index of health).</p>
<p>Difficulty in such a problem is that the residuals are then a matrix, and the nlfb rather than nlxb is a better approach. However, fitting 1 series would still need this data, and example nls14tryextraparms.txt shows that the extra parm (ms in this case) needs to be in the user’s globalenv.</p>
</div>
<div id="derivatives-table" class="section level2">
<h2>Derivatives table</h2>
<p>Note that this derivatives table is accomplished by example. We would like to have as many examples of different ways to use the tools as possible in order to provide a good understanding of the tools and their appropriate usage. In particular we want to know of errors. We compare the derivative tools Deriv() and fnDeriv() with the stats package tools D(), deriv() and deriv3().</p>
<p>See specific notes either in comments or at the end.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nls14)

<span class="co"># Various derivatives </span>

new &lt;-<span class="st"> </span><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="dv">1</span> +<span class="st"> </span>x +<span class="st"> </span>y), <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>))
old &lt;-<span class="st"> </span><span class="kw">deriv</span>(<span class="kw">quote</span>(<span class="dv">1</span> +<span class="st"> </span>x +<span class="st"> </span>y), <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>))
<span class="kw">print</span>(new)</code></pre>
<pre><code>## {
##     .value &lt;- 1 + x + y
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, c(&quot;x&quot;, 
##     &quot;y&quot;)))
##     .grad[, &quot;x&quot;] &lt;- 1
##     .grad[, &quot;y&quot;] &lt;- 1
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(new)</code></pre>
<pre><code>##  language {  .value &lt;- 1 + x + y; .grad &lt;- array(0, c(length(.value), 2L), list(NULL, c(&quot;x&quot;, &quot;y&quot;; ))); .grad[, &quot;x&quot;] &lt;- 1; .grad[, &quot;y&quot;] &lt;- 1; attr(.value, &quot;gradient&quot;) &lt;- .grad; .value }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.expression</span>(new)</code></pre>
<pre><code>## expression({
##     .value &lt;- 1 + x + y
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, c(&quot;x&quot;, 
##     &quot;y&quot;)))
##     .grad[, &quot;x&quot;] &lt;- 1
##     .grad[, &quot;y&quot;] &lt;- 1
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(old)</code></pre>
<pre><code>## expression({
##     .value &lt;- 1 + x + y
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, c(&quot;x&quot;, 
##         &quot;y&quot;)))
##     .grad[, &quot;x&quot;] &lt;- 1
##     .grad[, &quot;y&quot;] &lt;- 1
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(old)</code></pre>
<pre><code>##   expression({     .value &lt;- 1 + x + y     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, c(&quot;x&quot;, &quot;y&quot;)))     .grad[, &quot;x&quot;] &lt;- 1     .grad[, &quot;y&quot;] &lt;- 1     attr(.value, &quot;gradient&quot;) &lt;- .grad     .value })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">log</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## 1/x</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>( ~<span class="st"> </span><span class="kw">log</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- log(x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- 1/x
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">log</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## 1/x</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(<span class="st">&quot;but </span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre>
<pre><code>## but</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>( <span class="st">&quot;~ log(x)&quot;</span>, <span class="st">&quot;x&quot;</span>) <span class="co"># fails -- gives NA rather than expected answer due to quotes</span></code></pre>
<pre><code>## [1] NA</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">try</span>(<span class="kw">D</span>( ~<span class="st"> </span><span class="kw">log</span>(x), <span class="st">&quot;x&quot;</span>))

<span class="kw">Deriv</span>(<span class="kw">log</span>(x, <span class="dt">base=</span><span class="dv">3</span>), <span class="st">&quot;x&quot;</span> ) <span class="co"># OK</span></code></pre>
<pre><code>## 1/(x * 1.09861228866811)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">try</span>(<span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">log</span>(x, <span class="dt">base=</span><span class="dv">3</span>)), <span class="st">&quot;x&quot;</span> )) <span class="co"># fails - only single-argument calls supported</span>
<span class="kw">try</span>(<span class="kw">deriv</span>(~<span class="st"> </span><span class="kw">log</span>(x, <span class="dt">base=</span><span class="dv">3</span>), <span class="st">&quot;x&quot;</span> )) <span class="co"># fails - only single-argument calls supported</span>
<span class="kw">try</span>(<span class="kw">deriv</span>(<span class="kw">expression</span>(<span class="kw">log</span>(x, <span class="dt">base=</span><span class="dv">3</span>)), <span class="st">&quot;x&quot;</span> )) <span class="co"># fails - only single-argument calls supported</span>
<span class="kw">try</span>(<span class="kw">deriv3</span>(<span class="kw">expression</span>(<span class="kw">log</span>(x, <span class="dt">base=</span><span class="dv">3</span>)), <span class="st">&quot;x&quot;</span> )) <span class="co"># fails - only single-argument calls supported</span>
<span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">log</span>(x, <span class="dt">base=</span><span class="dv">3</span>)), <span class="st">&quot;x&quot;</span> )</code></pre>
<pre><code>## {
##     .value &lt;- log(x, base = 3)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- 1/(x * 1.09861228866811)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">exp</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## exp(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">exp</span>(x)), <span class="st">&quot;x&quot;</span>) <span class="co"># OK</span></code></pre>
<pre><code>## exp(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">exp</span>(x), <span class="st">&quot;x&quot;</span>) <span class="co"># OK, but much more complicated</span></code></pre>
<pre><code>## expression({
##     .expr1 &lt;- exp(x)
##     .value &lt;- .expr1
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- .expr1
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">exp</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .expr1 &lt;- exp(x)
##     .value &lt;- .expr1
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- .expr1
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">sin</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## cos(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">sin</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## cos(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">sin</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- sin(x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- cos(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">sin</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- sin(x)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- cos(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">cos</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## -sin(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">cos</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## -sin(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="st"> </span><span class="kw">cos</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- cos(x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- -sin(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">cos</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- cos(x)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- -sin(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">tan</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## 1/cos(x)^2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">tan</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## 1/cos(x)^2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="st"> </span><span class="kw">tan</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- tan(x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- 1/cos(x)^2
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">tan</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- tan(x)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- 1/cos(x)^2
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">sinh</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## cosh(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">sinh</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## cosh(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">sinh</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- sinh(x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- cosh(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">sinh</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- sinh(x)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- cosh(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">cosh</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## sinh(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">cosh</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## sinh(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">cosh</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- cosh(x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- sinh(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">cosh</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- cosh(x)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- sinh(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">sqrt</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## 0.5/sqrt(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">sqrt</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## 0.5 * x^-0.5</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">sqrt</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- sqrt(x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- 0.5 * x^-0.5
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">sqrt</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .expr1 &lt;- sqrt(x)
##     .value &lt;- .expr1
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- 0.5/.expr1
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">pnorm</span>(q), <span class="st">&quot;q&quot;</span>)</code></pre>
<pre><code>## dnorm(q)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">pnorm</span>(q)), <span class="st">&quot;q&quot;</span>)</code></pre>
<pre><code>## dnorm(q)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">pnorm</span>(q), <span class="st">&quot;q&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- pnorm(q)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;q&quot;)))
##     .grad[, &quot;q&quot;] &lt;- dnorm(q)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">pnorm</span>(q)), <span class="st">&quot;q&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- pnorm(q)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;q&quot;))
##     .grad[, &quot;q&quot;] &lt;- dnorm(q)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">dnorm</span>(x, mean), <span class="st">&quot;mean&quot;</span>)</code></pre>
<pre><code>## dnorm(x - mean) * (x - mean)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">dnorm</span>(x, mean)), <span class="st">&quot;mean&quot;</span>)</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">dnorm</span>(x, mean), <span class="st">&quot;mean&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- dnorm(x, mean)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;mean&quot;)))
##     .grad[, &quot;mean&quot;] &lt;- 0
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">dnorm</span>(x, mean)), <span class="st">&quot;mean&quot;</span>)</code></pre>
<pre><code>## {
##     .expr1 &lt;- x - mean
##     .value &lt;- dnorm(x, mean)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;mean&quot;))
##     .grad[, &quot;mean&quot;] &lt;- dnorm(.expr1) * .expr1
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">asin</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## 1/sqrt(1 + x^2)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">asin</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## 1/sqrt(1 - x^2)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">asin</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- asin(x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- 1/sqrt(1 - x^2)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">asin</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- asin(x)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- 1/sqrt(1 + x^2)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">acos</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## -1/sqrt(1 + x^2)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">acos</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## -(1/sqrt(1 - x^2))</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">acos</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- acos(x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- -(1/sqrt(1 - x^2))
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">acos</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- acos(x)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- -1/sqrt(1 + x^2)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">atan</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## 1/(1 + x^2)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">atan</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## 1/(1 + x^2)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">atan</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- atan(x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- 1/(1 + x^2)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">atan</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- atan(x)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- 1/(1 + x^2)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">gamma</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## gamma(x) * digamma(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">gamma</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## gamma(x) * digamma(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">gamma</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .expr1 &lt;- gamma(x)
##     .value &lt;- .expr1
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- .expr1 * digamma(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">gamma</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .expr1 &lt;- gamma(x)
##     .value &lt;- .expr1
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- .expr1 * digamma(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">lgamma</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## digamma(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">lgamma</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## digamma(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">lgamma</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- lgamma(x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- digamma(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">lgamma</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- lgamma(x)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- digamma(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">digamma</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## trigamma(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">digamma</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## trigamma(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">digamma</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- digamma(x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- trigamma(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">digamma</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- digamma(x)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- trigamma(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">trigamma</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## psigamma(x, 2L)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">trigamma</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## psigamma(x, 2L)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">trigamma</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- trigamma(x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- psigamma(x, 2L)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">trigamma</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- trigamma(x)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- psigamma(x, 2L)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">psigamma</span>(x, <span class="dt">deriv =</span> <span class="dv">5</span>), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## psigamma(x, 6)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">psigamma</span>(x, <span class="dt">deriv =</span> <span class="dv">5</span>)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## psigamma(x, 6L)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="kw">psigamma</span>(x, <span class="dt">deriv =</span> <span class="dv">5</span>), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- psigamma(x, deriv = 5)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- psigamma(x, 6L)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">psigamma</span>(x, <span class="dt">deriv =</span> <span class="dv">5</span>)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- psigamma(x, deriv = 5)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- psigamma(x, 6)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(x*y, <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## y</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(x*y), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## y</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~x*y, <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- x * y
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- y
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(x*y), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- x * y
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- y
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(x/y, <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## 1/y</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(x/y), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## 1/y</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~x/y, <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- x/y
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- 1/y
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(x/y), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- x/y
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- 1/y
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(x^y, <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## y * x^(y - 1)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(x^y), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## x^(y - 1) * y</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~x^y, <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- x^y
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- x^(y - 1) * y
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(x^y), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- x^y
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- y * x^(y - 1)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>((x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>((x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- (x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- 1
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>((x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- (x)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- 1
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(+x, <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(+x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="st"> </span>+x, <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- +x
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- 1
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(+x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- +x
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- 1
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(-x, <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## [1] -1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">D</span>(<span class="kw">expression</span>(-<span class="st"> </span>x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## -1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deriv</span>(~<span class="st"> </span>-x, <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## expression({
##     .value &lt;- -x
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- -1
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fnDeriv</span>(<span class="kw">quote</span>(-x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- -x
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- -1
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">abs</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## sign(x)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">try</span>(<span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">abs</span>(x)), <span class="st">&quot;x&quot;</span>)) <span class="co"># 'abs' not in derivatives table</span>
<span class="kw">try</span>(<span class="kw">deriv</span>(~<span class="st"> </span><span class="kw">abs</span>(x), <span class="st">&quot;x&quot;</span>))
<span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">abs</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- abs(x)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- sign(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Deriv</span>(<span class="kw">sign</span>(x), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">try</span>(<span class="kw">D</span>(<span class="kw">expression</span>(<span class="kw">sign</span>(x)), <span class="st">&quot;x&quot;</span>)) <span class="co"># 'sign' not in derivatives table</span>
<span class="kw">try</span>(<span class="kw">deriv</span>(~<span class="st"> </span><span class="kw">sign</span>(x), <span class="st">&quot;x&quot;</span>))
<span class="kw">fnDeriv</span>(<span class="kw">quote</span>(<span class="kw">sign</span>(x)), <span class="st">&quot;x&quot;</span>)</code></pre>
<pre><code>## {
##     .value &lt;- sign(x)
##     .grad &lt;- array(0, c(length(.value), 2L), list(NULL, &quot;x&quot;))
##     .grad[, &quot;x&quot;] &lt;- 0
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## }</code></pre>
<p>Notes:</p>
<ul>
<li><p>the base tool deriv (and likely deriv3 ?? need to explore and explain) and nls14::fnDeriv are intended to output a function to compute a derivative. deriv generates an expression object, while fnDeriv will generate a language object. Do we need to explain this more?? Note that input to deriv is of the form of a tilde expression with no left hand side, while fnDeriv uses a quoted expression. ?? We should explore more ways to input things to these tools.</p></li>
<li><p>the base tool D and nls14::Deriv generate expressions, but D requires an expression, while Deriv can handle the expression without a wrapper. ?? Do we need to discuss more??</p></li>
<li><p>nls14 includes abs(x) and sign(x) in the derivatives table despite conventional wisdom that these are not differentiable. However, abs(x) clearly has a defined derivative everywhere except at x = 0, where assigning a value of 0 to the derivative is almost certainly acceptable in computations. Similarly for sign(x).</p></li>
</ul>
<div id="simplifying-algebraic-expressions" class="section level3">
<h3>Simplifying algebraic expressions</h3>
<p><strong>nls14</strong> also includes some tools for simplification of algebraic expressions. Such simplification does not appear to be available / exposed in the</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Various simplifications</span>

<span class="kw">Simplify</span>(<span class="kw">quote</span>(+(a+b)))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(-<span class="dv">5</span>))</code></pre>
<pre><code>## [1] -5</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(--(a+b)))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="kw">exp</span>(<span class="kw">log</span>(a+b))))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="kw">exp</span>(<span class="dv">1</span>)))</code></pre>
<pre><code>## [1] 2.718282</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="kw">log</span>(<span class="kw">exp</span>(a+b))))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="kw">log</span>(<span class="dv">1</span>)))</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(!<span class="ot">TRUE</span>))</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(!<span class="ot">FALSE</span>))</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>((a+b)))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(a +<span class="st"> </span>b +<span class="st"> </span><span class="dv">0</span>))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="dv">0</span> +<span class="st"> </span>a +<span class="st"> </span>b))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>((a+b) +<span class="st"> </span>(a+b)))</code></pre>
<pre><code>## 2 * (a + b)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="dv">1</span> +<span class="st"> </span><span class="dv">4</span>))</code></pre>
<pre><code>## [1] 5</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(a +<span class="st"> </span>b -<span class="st"> </span><span class="dv">0</span>))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="dv">0</span> -<span class="st"> </span>a -<span class="st"> </span>b))</code></pre>
<pre><code>## -a - b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>((a+b) -<span class="st"> </span>(a+b)))</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="dv">5</span> -<span class="st"> </span><span class="dv">3</span>))</code></pre>
<pre><code>## [1] 2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="dv">0</span>*(a+b)))</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>((a+b)*<span class="dv">0</span>))</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(1L *<span class="st"> </span>(a+b)))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>((a+b) *<span class="st"> </span><span class="dv">1</span>))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>((-<span class="dv">1</span>)*(a+b)))</code></pre>
<pre><code>## -(a + b)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>((a+b)*(-<span class="dv">1</span>)))</code></pre>
<pre><code>## -(a + b)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="dv">2</span>*<span class="dv">5</span>))</code></pre>
<pre><code>## [1] 10</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>((a+b) /<span class="st"> </span><span class="dv">1</span>))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>((a+b) /<span class="st"> </span>(-<span class="dv">1</span>)))</code></pre>
<pre><code>## -(a + b)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="dv">0</span>/(a+b)))</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="dv">1</span>/<span class="dv">3</span>))</code></pre>
<pre><code>## [1] 0.3333333</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>((a+b) ^<span class="st"> </span><span class="dv">1</span>))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="dv">2</span>^<span class="dv">10</span>))</code></pre>
<pre><code>## [1] 1024</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="kw">log</span>(<span class="kw">exp</span>(a), <span class="dv">3</span>)))</code></pre>
<pre><code>## a/1.09861228866811</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="ot">FALSE</span> &amp;&amp;<span class="st"> </span>b))</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(a &amp;&amp;<span class="st"> </span><span class="ot">TRUE</span>))</code></pre>
<pre><code>## a</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="ot">TRUE</span> &amp;&amp;<span class="st"> </span>b))</code></pre>
<pre><code>## b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(a ||<span class="st"> </span><span class="ot">TRUE</span>))</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(<span class="ot">FALSE</span> ||<span class="st"> </span>b))</code></pre>
<pre><code>## b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(a ||<span class="st"> </span><span class="ot">FALSE</span>))</code></pre>
<pre><code>## a</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(if (<span class="ot">TRUE</span>) a+b))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(if (<span class="ot">FALSE</span>) a+b))</code></pre>
<pre><code>## NULL</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(if (<span class="ot">TRUE</span>) a+b else a*b))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(if (<span class="ot">FALSE</span>) a+b else a*b))</code></pre>
<pre><code>## a * b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Simplify</span>(<span class="kw">quote</span>(if (cond) a+b else a+b))</code></pre>
<pre><code>## a + b</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This one was wrong...</span>
<span class="kw">Simplify</span>(<span class="kw">quote</span>(--(a+b)))</code></pre>
<pre><code>## a + b</code></pre>
</div>
</div>
<div id="examples-of-use" class="section level2">
<h2>Examples of use</h2>
<div id="nonlinear-least-squares-with-expressions" class="section level3">
<h3>Nonlinear least squares with expressions</h3>
<p>We use the Hobbs Weeds problem (Nash, 1979 and Nash, 2014). Note that nls() fails from start1.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(nls14)
traceval &lt;-<span class="st"> </span><span class="ot">FALSE</span>
<span class="co"># Data for Hobbs problem</span>
ydat  &lt;-<span class="st">  </span><span class="kw">c</span>(<span class="fl">5.308</span>, <span class="fl">7.24</span>, <span class="fl">9.638</span>, <span class="fl">12.866</span>, <span class="fl">17.069</span>, <span class="fl">23.192</span>, <span class="fl">31.443</span>, 
          <span class="fl">38.558</span>, <span class="fl">50.156</span>, <span class="fl">62.948</span>, <span class="fl">75.995</span>, <span class="fl">91.972</span>) <span class="co"># for testing</span>
tdat  &lt;-<span class="st">  </span><span class="kw">seq_along</span>(ydat) <span class="co"># for testing</span>

<span class="co"># A simple starting vector -- must have named parameters for nls14xb, nls, wrap14nls.</span>
start1  &lt;-<span class="st">  </span><span class="kw">c</span>(<span class="dt">b1=</span><span class="dv">1</span>, <span class="dt">b2=</span><span class="dv">1</span>, <span class="dt">b3=</span><span class="dv">1</span>)

eunsc  &lt;-<span class="st">   </span>y ~<span class="st"> </span>b1/(<span class="dv">1</span>+b2*<span class="kw">exp</span>(-b3*tt))

<span class="kw">cat</span>(<span class="st">&quot;LOCAL DATA IN DATA FRAMES</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre>
<pre><code>## LOCAL DATA IN DATA FRAMES</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">weeddata1  &lt;-<span class="st">  </span><span class="kw">data.frame</span>(<span class="dt">y=</span>ydat, <span class="dt">tt=</span>tdat)
weeddata2  &lt;-<span class="st">  </span><span class="kw">data.frame</span>(<span class="dt">y=</span><span class="fl">1.5</span>*ydat, <span class="dt">tt=</span>tdat)

anls14xb1  &lt;-<span class="st">  </span><span class="kw">try</span>(<span class="kw">nls14xb</span>(eunsc, <span class="dt">start=</span>start1, <span class="dt">trace=</span><span class="ot">TRUE</span>, <span class="dt">data=</span>weeddata1,
                     <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">watch=</span><span class="ot">FALSE</span>)))</code></pre>
<pre><code>## formula: y ~ b1/(1 + b2 * exp(-b3 * tt))
## lower:[1] -Inf -Inf -Inf
## upper:[1] Inf Inf Inf
## $watch
## [1] FALSE
## 
## $phi
## [1] 1
## 
## $lamda
## [1] 1e-04
## 
## $offset
## [1] 100
## 
## $laminc
## [1] 10
## 
## $lamdec
## [1] 4
## 
## $femax
## [1] 10000
## 
## $jemax
## [1] 5000
## 
## $rofftest
## [1] TRUE
## 
## $smallsstest
## [1] TRUE
## 
## vn:[1] &quot;y&quot;  &quot;b1&quot; &quot;b2&quot; &quot;b3&quot; &quot;tt&quot;
## datvar:[1] &quot;y&quot;  &quot;tt&quot;
## Data variable  y : [1]  5.308  7.240  9.638 12.866 17.069 23.192 31.443 38.558 50.156 62.948
## [11] 75.995 91.972
## Data variable  tt : [1]  1  2  3  4  5  6  7  8  9 10 11 12
## Finished masks check
## model2rjfun: modelformula = y ~ b1/(1 + b2 * exp(-b3 * tt))
## [1] &quot;formula&quot;
## trjfn:
## function (prm) 
## {
##     if (is.null(names(prm))) 
##         names(prm) &lt;- names(pvec)
##     localdata &lt;- list2env(as.list(prm), parent = data)
##     eval(residexpr, envir = localdata)
## }
## &lt;environment: 0x2f67f78&gt;
## Starting pnum=b1 b2 b3 
##  1  1  1 
## Start:lamda: 1e-04  SS= 23520.58  at  b1 = 1  b2 = 1  b3 = 1  1 / 0
## lamda: 0.001  SS= 24355.78  at  b1 = 50.88637  b2 = -240.7157  b3 = -372.9063  2 / 1
## lamda: 0.01  SS= 24355.78  at  b1 = 50.18287  b2 = -190.6899  b3 = -334.197  3 / 1
## lamda: 0.1  SS= 24355.78  at  b1 = 46.96994  b2 = -25.30862  b3 = -194.8134  4 / 1
## lamda: 1  SS= 24355.78  at  b1 = 38.09609  b2 = 29.92399  b3 = -64.26249  5 / 1
## lamda: 10  SS= 24352.57  at  b1 = 18.79845  b2 = 3.550992  b3 = -2.901089  6 / 1
## &lt;&lt;lamda: 4  SS= 21065.17  at  b1 = 4.101523  b2 = 0.8668807  b3 = 1.329686  7 / 1
## &lt;&lt;lamda: 1.6  SS= 16852.28  at  b1 = 10.24849  b2 = 1.230212  b3 = 1.004386  8 / 2
## lamda: 16  SS= 24077.82  at  b1 = 20.94439  b2 = 2.947339  b3 = -0.4095915  9 / 3
## &lt;&lt;lamda: 6.4  SS= 15933.75  at  b1 = 11.77098  b2 = 1.30839  b3 = 0.9808683  10 / 3
## &lt;&lt;lamda: 2.56  SS= 14050.37  at  b1 = 15.15227  b2 = 1.646833  b3 = 0.8046192  11 / 4
## &lt;&lt;lamda: 1.024  SS= 10984.53  at  b1 = 22.00496  b2 = 2.663208  b3 = 0.4511129  12 / 5
## &lt;&lt;lamda: 0.4096  SS= 6427.122  at  b1 = 35.12773  b2 = 4.713469  b3 = 0.5097411  13 / 6
## &lt;&lt;lamda: 0.16384  SS= 4725.038  at  b1 = 52.28509  b2 = 9.294817  b3 = 0.3134769  14 / 7
## &lt;&lt;lamda: 0.065536  SS= 1132.227  at  b1 = 76.44604  b2 = 15.14153  b3 = 0.4109482  15 / 8
## &lt;&lt;lamda: 0.0262144  SS= 518.7608  at  b1 = 96.92384  b2 = 24.42232  b3 = 0.358158  16 / 9
## &lt;&lt;lamda: 0.01048576  SS= 79.46363  at  b1 = 122.1849  b2 = 35.26152  b3 = 0.3648369  17 / 10
## &lt;&lt;lamda: 0.004194304  SS= 26.38693  at  b1 = 141.5485  b2 = 42.38658  b3 = 0.3521514  18 / 11
## &lt;&lt;lamda: 0.001677722  SS= 11.339  at  b1 = 160.024  b2 = 45.51922  b3 = 0.3373821  19 / 12
## &lt;&lt;lamda: 0.0006710886  SS= 5.276671  at  b1 = 176.9152  b2 = 47.03717  b3 = 0.32443  20 / 13
## &lt;&lt;lamda: 0.0002684355  SS= 2.965609  at  b1 = 189.1175  b2 = 48.27921  b3 = 0.3171216  21 / 14
## &lt;&lt;lamda: 0.0001073742  SS= 2.600262  at  b1 = 194.7168  b2 = 48.91974  b3 = 0.3142945  22 / 15
## &lt;&lt;lamda: 4.294967e-05  SS= 2.587347  at  b1 = 196.0419  b2 = 49.07496  b3 = 0.3136449  23 / 16
## &lt;&lt;lamda: 1.717987e-05  SS= 2.587277  at  b1 = 196.1798  b2 = 49.09089  b3 = 0.3135732  24 / 17
## &lt;&lt;lamda: 6.871948e-06  SS= 2.587277  at  b1 = 196.1861  b2 = 49.09162  b3 = 0.3135698  25 / 18</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(anls14xb1)</code></pre>
<pre><code>## nls14 class object: x 
## residual sumsquares =  2.5873  on  12 observations
##     after  18    Jacobian and  25 function evaluations
##   name            coeff          SE       tstat      pval      gradient    JSingval   
## b1               196.186         11.31      17.35  3.164e-08  -2.663e-07        1011  
## b2               49.0916         1.688      29.08  3.281e-10    1.59e-07      0.4605  
## b3               0.31357      0.006863      45.69  5.768e-12  -5.531e-05     0.04715</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">anlsb1 &lt;-<span class="st">  </span><span class="kw">try</span>(<span class="kw">nls</span>(eunsc, <span class="dt">start=</span>start1, <span class="dt">trace=</span><span class="ot">TRUE</span>, <span class="dt">data=</span>weeddata1))</code></pre>
<pre><code>## 23521 :  1 1 1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(anlsb1)</code></pre>
<pre><code>## [1] &quot;Error in nls(eunsc, start = start1, trace = TRUE, data = weeddata1) : \n  singular gradient\n&quot;
## attr(,&quot;class&quot;)
## [1] &quot;try-error&quot;
## attr(,&quot;condition&quot;)
## &lt;simpleError in nls(eunsc, start = start1, trace = TRUE, data = weeddata1): singular gradient&gt;</code></pre>
<p>A different start causes nls14xb to return a large sum of squares. Note that nls() again fails.</p>
<pre class="sourceCode r"><code class="sourceCode r">startf1  &lt;-<span class="st">  </span><span class="kw">c</span>(<span class="dt">b1=</span><span class="dv">1</span>, <span class="dt">b2=</span><span class="dv">1</span>, <span class="dt">b3=</span>.<span class="dv">1</span>)
anlsf1 &lt;-<span class="st">  </span><span class="kw">try</span>(<span class="kw">nls</span>(eunsc, <span class="dt">start=</span>startf1, <span class="dt">trace=</span><span class="ot">TRUE</span>, <span class="dt">data=</span>weeddata1))</code></pre>
<pre><code>## 23756 :  1.0 1.0 0.1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(anlsf1)</code></pre>
<pre><code>## [1] &quot;Error in nls(eunsc, start = startf1, trace = TRUE, data = weeddata1) : \n  singular gradient\n&quot;
## attr(,&quot;class&quot;)
## [1] &quot;try-error&quot;
## attr(,&quot;condition&quot;)
## &lt;simpleError in nls(eunsc, start = startf1, trace = TRUE, data = weeddata1): singular gradient&gt;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">anls14xf1  &lt;-<span class="st">  </span><span class="kw">try</span>(<span class="kw">nls14xb</span>(eunsc, <span class="dt">start=</span>startf1, <span class="dt">trace=</span><span class="ot">TRUE</span>, <span class="dt">data=</span>weeddata1,
                     <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">watch=</span><span class="ot">FALSE</span>)))</code></pre>
<pre><code>## formula: y ~ b1/(1 + b2 * exp(-b3 * tt))
## lower:[1] -Inf -Inf -Inf
## upper:[1] Inf Inf Inf
## $watch
## [1] FALSE
## 
## $phi
## [1] 1
## 
## $lamda
## [1] 1e-04
## 
## $offset
## [1] 100
## 
## $laminc
## [1] 10
## 
## $lamdec
## [1] 4
## 
## $femax
## [1] 10000
## 
## $jemax
## [1] 5000
## 
## $rofftest
## [1] TRUE
## 
## $smallsstest
## [1] TRUE
## 
## vn:[1] &quot;y&quot;  &quot;b1&quot; &quot;b2&quot; &quot;b3&quot; &quot;tt&quot;
## datvar:[1] &quot;y&quot;  &quot;tt&quot;
## Data variable  y : [1]  5.308  7.240  9.638 12.866 17.069 23.192 31.443 38.558 50.156 62.948
## [11] 75.995 91.972
## Data variable  tt : [1]  1  2  3  4  5  6  7  8  9 10 11 12
## Finished masks check
## model2rjfun: modelformula = y ~ b1/(1 + b2 * exp(-b3 * tt))
## [1] &quot;formula&quot;
## trjfn:
## function (prm) 
## {
##     if (is.null(names(prm))) 
##         names(prm) &lt;- names(pvec)
##     localdata &lt;- list2env(as.list(prm), parent = data)
##     eval(residexpr, envir = localdata)
## }
## &lt;environment: 0x23de2c0&gt;
## Starting pnum= b1  b2  b3 
## 1.0 1.0 0.1 
## Start:lamda: 1e-04  SS= 23756  at  b1 = 1  b2 = 1  b3 = 0.1  1 / 0
## lamda: 0.001  SS= 24356  at  b1 = 416.72  b2 = 821.43  b3 = -40.851  2 / 1
## lamda: 0.01  SS= 196562  at  b1 = 162.93  b2 = 368.16  b3 = 7.5932  3 / 1
## &lt;&lt;lamda: 0.004  SS= 10597  at  b1 = 24.764  b2 = 108.11  b3 = 31.926  4 / 1
## &lt;&lt;lamda: 0.0016  SS= 9205.5  at  b1 = 35.486  b2 = 108.11  b3 = 31.926  5 / 2
## &lt;&lt;lamda: 0.00064  SS= 9205.4  at  b1 = 35.532  b2 = 108.11  b3 = 31.926  6 / 3
## &lt;&lt;lamda: 0.000256  SS= 9205.4  at  b1 = 35.532  b2 = 108.11  b3 = 31.926  7 / 4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(anls14xf1)</code></pre>
<pre><code>## nls14 class object: x 
## residual sumsquares =  9205.4  on  12 observations
##     after  4    Jacobian and  7 function evaluations
##   name            coeff          SE       tstat      pval      gradient    JSingval   
## b1               35.5321            NA         NA         NA  -6.684e-07       3.464  
## b2               108.109            NA         NA         NA  -1.464e-11   5.015e-11  
## b3               31.9262            NA         NA         NA   1.583e-09   6.427e-27</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># anls14xb2  &lt;-  try(nls14xb(eunsc, start=start1, trace=FALSE, data=weeddata2))</span>
<span class="co"># print(anls14xb2)</span></code></pre>
<p>We can discover quickly the difficulty here by computing the Jacobian at this “solution” and checking its singular values.</p>
<pre class="sourceCode r"><code class="sourceCode r">cf1 &lt;-<span class="st"> </span><span class="kw">coef</span>(anls14xf1)
<span class="kw">print</span>(cf1)</code></pre>
<pre><code>##      b1      b2      b3 
##  35.532 108.109  31.926 
## attr(,&quot;pkgname&quot;)
## [1] &quot;nls14&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">jf1 &lt;-<span class="st"> </span>anls14xf1$jacobian
svals &lt;-<span class="st"> </span><span class="kw">svd</span>(jf1)$d
<span class="kw">print</span>(svals)</code></pre>
<pre><code>## [1] 3.4641e+00 5.0146e-11 6.4267e-27</code></pre>
<p>Here we see that the Jacobian is only rank 1, even though there are 3 coefficients. It is therefore not surprising that our nonlinear least squares program has concluded we are unable to make further progress.</p>
<div id="check-modelexpr-works-with-an-ssgrfun" class="section level4">
<h4>check modelexpr() works with an ssgrfun ??</h4>
</div>
<div id="test-model2rjfun-vs-model2rjfunx" class="section level4">
<h4>test model2rjfun vs model2rjfunx ??</h4>
</div>
<div id="why-is-resss-difficult-to-use-in-optimization" class="section level4">
<h4>Why is resss difficult to use in optimization?</h4>
<pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">5.308</span>, <span class="fl">7.24</span>, <span class="fl">9.638</span>, <span class="fl">12.866</span>, <span class="fl">17.069</span>, <span class="fl">23.192</span>, <span class="fl">31.443</span>, <span class="fl">38.558</span>,
<span class="fl">50.156</span>, <span class="fl">62.948</span>, <span class="fl">75.995</span>, <span class="fl">91.972</span>)
tt &lt;-<span class="st"> </span><span class="kw">seq_along</span>(y) <span class="co"># for testing</span>
mydata &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">y =</span> y, <span class="dt">tt =</span> tt)
f &lt;-<span class="st"> </span>y ~<span class="st"> </span><span class="dv">100</span>*b1/(<span class="dv">1</span> +<span class="st"> </span><span class="dv">10</span>*b2 *<span class="st"> </span><span class="kw">exp</span>(-<span class="fl">0.1</span> *<span class="st"> </span>b3 *<span class="st"> </span>tt))
p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">b1 =</span> <span class="dv">1</span>, <span class="dt">b2 =</span> <span class="dv">1</span>, <span class="dt">b3 =</span> <span class="dv">1</span>)
rjfn &lt;-<span class="st"> </span><span class="kw">model2rjfun</span>(f, p, <span class="dt">data =</span> mydata)</code></pre>
<pre><code>## model2rjfun: modelformula = y ~ 100 * b1/(1 + 10 * b2 * exp(-0.1 * b3 * tt))
## [1] &quot;formula&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rjfn</span>(p)</code></pre>
<pre><code>##  [1]   4.64386   3.64458   2.25518   0.11562  -2.91533  -7.77921 -14.68094
##  [8] -20.35397 -30.41538 -41.57497 -52.89343 -67.04642
## attr(,&quot;gradient&quot;)
##            b1       b2       b3
##  [1,]  9.9519  -8.9615  0.89615
##  [2,] 10.8846  -9.6998  1.93997
##  [3,] 11.8932 -10.4787  3.14361
##  [4,] 12.9816 -11.2964  4.51856
##  [5,] 14.1537 -12.1504  6.07520
##  [6,] 15.4128 -13.0373  7.82235
##  [7,] 16.7621 -13.9524  9.76668
##  [8,] 18.2040 -14.8902 11.91213
##  [9,] 19.7406 -15.8437 14.25933
## [10,] 21.3730 -16.8050 16.80496
## [11,] 23.1016 -17.7647 19.54122
## [12,] 24.9256 -18.7127 22.45528</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">myfn &lt;-<span class="st"> </span>function(p, <span class="dt">resfn=</span>rjfn){
  val &lt;-<span class="st"> </span><span class="kw">resss</span>(p, resfn)
}

p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">b1 =</span> <span class="dv">2</span>, <span class="dt">b2=</span><span class="dv">2</span>, <span class="dt">b3=</span><span class="dv">1</span>)

a1 &lt;-<span class="st"> </span><span class="kw">optim</span>(p, myfn, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">trace=</span><span class="dv">0</span>))
a1</code></pre>
<pre><code>## $par
##     b1     b2     b3 
## 1.9618 4.9092 3.1358 
## 
## $value
## [1] 2.5873
## 
## $counts
## function gradient 
##      200       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<p>We can also embed the function directly.</p>
<pre class="sourceCode r"><code class="sourceCode r">a2 &lt;-<span class="st"> </span><span class="kw">optim</span>(p, function(p,<span class="dt">resfn=</span>rjfn){<span class="kw">resss</span>(p,resfn)}, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">trace=</span><span class="dv">0</span>))
a2</code></pre>
<pre><code>## $par
##     b1     b2     b3 
## 1.9618 4.9092 3.1358 
## 
## $value
## [1] 2.5873
## 
## $counts
## function gradient 
##      200       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
</div>
<div id="need-more-extensive-discussion-of-simplify" class="section level4">
<h4>Need more extensive discussion of Simplify??</h4>
</div>
</div>
</div>
<div id="vignette-info" class="section level2">
<h2>Vignette Info</h2>
<p>Note the various macros within the <code>vignette</code> setion of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the <code>title</code> field and the <code>\VignetteIndexEntry</code> to match the title of your vignette.</p>
</div>
<div id="styles" class="section level2">
<h2>Styles</h2>
<p>The <code>html_vignette</code> template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:</p>
<pre><code>output: 
  rmarkdown::html_vignette:
    css: mystyles.css</code></pre>
</div>
<div id="figures" class="section level2">
<h2>Figures</h2>
<p>The figure sizes have been customised so that you can easily put two images side-by-side.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dv">1</span>:<span class="dv">10</span>)
<span class="kw">plot</span>(<span class="dv">10</span>:<span class="dv">1</span>)</code></pre>
<p><img src="data:image/png;base64,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" /> <img src="data:image/png;base64,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" /></p>
<p>You can enable figure captions by <code>fig_caption: yes</code> in YAML:</p>
<pre><code>output:
  rmarkdown::html_vignette:
    fig_caption: yes</code></pre>
<p>Then you can use the chunk option <code>fig.cap = &quot;Your figure caption.&quot;</code> in <strong>knitr</strong>.</p>
</div>
<div id="more-examples" class="section level2">
<h2>More Examples</h2>
<p>You can write math expressions, e.g. <span class="math">\(Y = X\beta + \epsilon\)</span>, footnotes<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>, and tables, e.g. using <code>knitr::kable()</code>.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mpg</th>
<th align="right">cyl</th>
<th align="right">disp</th>
<th align="right">hp</th>
<th align="right">drat</th>
<th align="right">wt</th>
<th align="right">qsec</th>
<th align="right">vs</th>
<th align="right">am</th>
<th align="right">gear</th>
<th align="right">carb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Mazda RX4</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160.0</td>
<td align="right">110</td>
<td align="right">3.90</td>
<td align="right">2.620</td>
<td align="right">16.46</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Mazda RX4 Wag</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160.0</td>
<td align="right">110</td>
<td align="right">3.90</td>
<td align="right">2.875</td>
<td align="right">17.02</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">Datsun 710</td>
<td align="right">22.8</td>
<td align="right">4</td>
<td align="right">108.0</td>
<td align="right">93</td>
<td align="right">3.85</td>
<td align="right">2.320</td>
<td align="right">18.61</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Hornet 4 Drive</td>
<td align="right">21.4</td>
<td align="right">6</td>
<td align="right">258.0</td>
<td align="right">110</td>
<td align="right">3.08</td>
<td align="right">3.215</td>
<td align="right">19.44</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Hornet Sportabout</td>
<td align="right">18.7</td>
<td align="right">8</td>
<td align="right">360.0</td>
<td align="right">175</td>
<td align="right">3.15</td>
<td align="right">3.440</td>
<td align="right">17.02</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Valiant</td>
<td align="right">18.1</td>
<td align="right">6</td>
<td align="right">225.0</td>
<td align="right">105</td>
<td align="right">2.76</td>
<td align="right">3.460</td>
<td align="right">20.22</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Duster 360</td>
<td align="right">14.3</td>
<td align="right">8</td>
<td align="right">360.0</td>
<td align="right">245</td>
<td align="right">3.21</td>
<td align="right">3.570</td>
<td align="right">15.84</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Merc 240D</td>
<td align="right">24.4</td>
<td align="right">4</td>
<td align="right">146.7</td>
<td align="right">62</td>
<td align="right">3.69</td>
<td align="right">3.190</td>
<td align="right">20.00</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Merc 230</td>
<td align="right">22.8</td>
<td align="right">4</td>
<td align="right">140.8</td>
<td align="right">95</td>
<td align="right">3.92</td>
<td align="right">3.150</td>
<td align="right">22.90</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Merc 280</td>
<td align="right">19.2</td>
<td align="right">6</td>
<td align="right">167.6</td>
<td align="right">123</td>
<td align="right">3.92</td>
<td align="right">3.440</td>
<td align="right">18.30</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<p>Also a quote using <code>&gt;</code>:</p>
<blockquote>
<p>“He who gives up [code] safety for [code] speed deserves neither.” (<a href="https://twitter.com/hadleywickham/status/504368538874703872">via</a>)</p>
</blockquote>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>A footnote here.<a href="#fnref1">↩</a></p></li>
</ol>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
